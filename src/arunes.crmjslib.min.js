function arunesCrmJsLib(){this.async=true;var e=window.console;var t="console"in window&&typeof console!="undefined";window.console={log:function(n){if(t)e.log(n)},debug:function(n){if(t){if(typeof e.debug!="undefined"){e.debug(n)}else{e.log(n)}}},info:function(n){if(t){if(typeof e.info!="undefined"){e.info(n)}else{e.log(n)}}},warn:function(n){if(t){if(typeof e.warn!="undefined"){e.warn(n)}else{e.log(n)}}},error:function(n){if(t){if(typeof e.error!="undefined"){e.error(n)}else{e.log(n)}}}};if(typeof Xrm==="undefined"||Xrm.Page.getAttribute==undefined)Xrm=parent.Xrm;if(Xrm==="undefined"){throw{name:"XrmError",message:"Xrm page context cannot be found, please include ClientGlobalContext or execute this page as a webresource / iframe"};console.error("Xrm page context cannot be found, please include ClientGlobalContext or execute this page as a webresource / iframe")}else{console.info("Xrm page context loaded successfully.")}this.getValue=function(e){try{console.log("Getting value of '"+e+"'.");return Xrm.Page.getAttribute(e).getValue()}catch(t){console.warn("Getting value of '"+e+"' failed!");console.debug(t);return null}};this.getCurrentId=function(){try{console.log("Getting id of current entity.");return Xrm.Page.data.entity.getId()}catch(e){console.warn("Getting id of current entity failed!");console.debug(e);return null}};this.getUserId=function(){try{console.log("Getting id of current user.");return Xrm.Page.context.getUserId()}catch(e){console.warn("Getting id of current user failed!");console.debug(e);return null}};this.getEntityName=function(){try{console.log("Getting name of current entity.");return Xrm.Page.data.entity.getEntityName()}catch(e){console.warn("Getting name of current entity failed!");console.debug(e);return null}};this.getSubmitMode=function(e){try{console.log("Getting submit mode of '"+e+"'.");return Xrm.Page.getAttribute(e).getSubmitMode()}catch(t){console.warn("Getting submit mode of '"+e+"' failed!");console.debug(t);return null}};this.isValueChanged=function(e){try{console.log("Getting is dirty mode of '"+e+"'.");return Xrm.Page.getAttribute(e).getIsDirty()}catch(t){console.warn("Getting is dirty mode of '"+e+"' failed!");console.debug(t);return false}};this.getText=function(e){try{console.log("Getting text of '"+e+"'.");var t=Xrm.Page.ui.controls.get(e);if(t!=null){switch(t.getControlType()){case"lookup":var n=this.getValue(e);if(n!=null)return n[0].name;break;case"optionset":return Xrm.Page.getAttribute(e).getText();default:console.warn("'"+e+"' element is should be lookup or optionset to get text!");return null}}else{console.warn("'"+e+"' element not found!")}return null}catch(r){console.warn("Getting text of '"+e+"' failed!");console.debug(r);return null}};this.getWRScript=function(e,t){if(jQuery){e="/"+ORG_UNIQUE_NAME+"/WebResources/"+e;console.info("Loading webresource '"+e+"'.");$.getScript(e,function(){console.info("'"+e+"' loaded successfully!");if(typeof t=="function")t()})}else{console.warn("getWRScript function needs jQuery library to execute. Please include jQuery.")}};this.setValue=function(e,t){try{console.log("Setting value '"+t+"' to '"+e+"'.");Xrm.Page.getAttribute(e).setValue(t)}catch(n){console.warn("Setting value '"+t+"' to '"+e+"' is failed!");console.debug(n)}};this.setLookupValue=function(e,t,n,r){console.log("Setting lookup value (id: '"+t+"', name: '"+n+"', type: '"+r+"') to '"+e+"'");var i=new Array;i[0]=new Object;i[0].id=t;i[0].name=n;i[0].entityType=r;this.setValue(e,i)};this.setDisabled=function(e,t){try{console.log("Setting disabled '"+t+"' to '"+e+"'.");Xrm.Page.ui.controls.get(e).setDisabled(t)}catch(n){console.warn("Setting disabled '"+t+"' to '"+e+"' is failed!");console.debug(n)}};this.setVisible=function(e,t){try{console.log("Setting visible '"+t+"' to '"+e+"'.");Xrm.Page.ui.controls.get(e).setVisible(t)}catch(n){console.warn("Setting visible '"+t+"' to '"+e+"' is failed!");console.debug(n)}};this.setVisibleTabSection=function(e,t,n){try{var r=Xrm.Page.ui.tabs.get(e);if(r!=null){if(t==null){console.log("Changing visibility to '"+visible+"' of tab '"+e+"'.");r.setVisible(n)}else{var i=r.sections.get(t);if(i!=null){console.log("Changing visibility to '"+visible+"' of section '"+t+"'.");i.setVisible(n);if(n)r.setVisible(n)}else{console.warn("'"+i+"' section could not be found!")}}}else{console.warn("'"+e+"' tab could not be found!")}}catch(s){console.warn("Changing visibility of tab '"+e+"' or section '"+t+"' to '"+n+"' is failed!");console.debug(s)}};this.getControl=function(e){try{console.log("Getting control '"+e+"'.");return Xrm.Page.getControl(e)}catch(t){console.warn("Getting control '"+e+"' is failed!");console.debug(t);return null}};this.setFrameUrl=function(e,t){try{console.log("Setting url '"+t+"' for frame '"+e+"'.");this.getControl(e).setSrc(t)}catch(n){console.warn("Setting url '"+t+"' for frame '"+e+"' is failed!");console.debug(n)}};this.reloadFrame=function(e){try{console.log("Reloading frame '"+e+"'.");this.setFrameUrl(e,this.getControl(e).getSrc())}catch(t){console.warn("Reloading frame '"+e+"' is failed!");console.debug(t)}};this.addValueToQueryString=function(e,t,n){try{console.log("Adding '"+e+"="+t+"' to '"+n+"'.");if(n==null){if(document.location.href.split("?")[1]!=null){n=document.location.href.split("?")[1]}else{return"?"+e+"="+t}}var r=0;var s=0;if(n!=""&&n!=null){r=n.indexOf(e);if(r>-1){var o=n.split("&");if(o.length>0){for(i=0;i<o.length;i++){if(o[i].substring(0,e.length)==e)s=i}return"?"+n.replace(o[s],e+"="+t)}else{return"?"+e+"="+t}}else{return"?"+n+"&"+e+"="+t}}else{return"?"+e+"="+t}}catch(u){console.warn("Adding '"+e+"="+t+"' to '"+n+"' is failed!");console.debug(u);return null}};this.setRequirementLevel=function(e,t){try{console.log("Setting requirement level '"+t+"' to '"+e+"'.");Xrm.Page.getAttribute(e).setRequiredLevel(t)}catch(n){console.warn("Setting requirement level '"+t+"' to '"+e+"' is failed!");console.debug(n)}};this.getFormType=function(){try{console.log("Getting form type.");return Xrm.Page.ui.getFormType()}catch(e){console.warn("Getting form type is failed!");console.debug(e);return null}};this.setFocus=function(e){try{console.log("Setting focus to '"+e+"'.");Xrm.Page.ui.controls.get(e).setFocus()}catch(t){console.warn("Setting focus to '"+e+"' is failed!");console.debug(t)}};this.makeMultipleSelect=function(e,t,n,r){try{console.log("Making picklist '"+e+"' multiple. (txtPicklist:'"+t+"', valPicklist: '"+n+"', size:'"+r+"')");r=r==undefined?6:r;$("#"+e+" option:first").remove();$("#"+e).attr({multiple:"multiple",size:r}).change(function(){$$.setValue(n,$(this).val().toString());var r=new Array;$.each($("#"+e+" option:selected"),function(e,t){r.push($(t).text())});$$.setValue(t,r.join(", "))});var i=$$.getValue(n);if(i!=null){$.each(i.split(","),function(t,n){$("#"+e+" option[value='"+n+"']").attr("selected","selected")})}}catch(s){console.warn("Making picklist '"+e+"' multiple is failed! (txtPicklist:'"+t+"', valPicklist: '"+n+"', size:'"+r+"')");console.debug(s)}};this.makePicklistRelated=function(e,t){try{console.log("Making picklists related '"+e+"' - '"+t+"'.");var n=$("#"+e);var r=$("#"+t);n.attr("_childs",r.html());r.empty();n.change(function(){var e=$(this).val();r.empty();$("<option/>").appendTo(r);if(e!=""){var t=$($(this).attr("_childs"));$.each(t,function(t,n){if($(n).val().toString().indexOf(e)==0){$(n).appendTo(r)}})}});n.change()}catch(i){console.warn("Making picklists related '"+e+"' - '"+t+"' is failed.");console.debug(i)}};this.getServerUrl=function(){try{console.log("Getting server url.");var e=document.location.toString();var t=e.split("//")[1].split("/")[0];var n=WEB_SERVER_HOST;var r=ORG_UNIQUE_NAME;var i=e.split("//")[0];var s=AUTHENTICATION_TYPE==0;if(s)return i+"//"+t+"/"+r;else return i+"//"+t}catch(o){try{console.warn("Getting server url is failed! returning default url.");console.debug(o);return Xrm.Page.context.getServerUrl()}catch(u){console.warn("Getting default server url is failed!");console.debug(u);return null}}};this.getServiceUrl=function(){console.log("Getting service url.");return this.getServerUrl()+"/XRMServices/2011/OrganizationData.svc"};this.getSoapUrl=function(){console.log("Getting soap url.");return this.getServerUrl()+"/XRMServices/2011/Organization.svc/web"};this.retrieveOne=function(e,t,n,r){if(jQuery){var i=this.getServiceUrl();var s="/"+e+"Set(guid'"+t+"')";console.log("Retrieving a '"+e+"' record with id '"+t+"'.");$.ajax({async:r!=undefined?r:this.async,type:"GET",contentType:"application/json; charset=utf-8",datatype:"json",url:i+s,beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(r,i,s){console.info("'"+e+"' record with id '"+t+"' is retrieved successfully!");n(r.d)},error:function(r,i,s){console.error("Retrieving a '"+e+"' record with id '"+t+"' is failed! Details are in below.");console.debug(r);console.debug(i);console.debug(s);n(null)}})}else{console.warn("retrieveOne function needs jQuery library to execute. Please include jQuery.")}};this.retrieveWithQuery=function(e,t,n,r){if(jQuery){var i=this.getServiceUrl();var s="/"+e+"Set?"+t;console.log("Retrieving a '"+e+"' records with query '"+t+"'.");$.ajax({async:r!=undefined?r:this.async,type:"GET",contentType:"application/json; charset=utf-8",datatype:"json",url:i+s,beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(r,i,s){console.info("'"+e+"' records with query '"+t+"' is retrieved successfully!");n(r.d.results)},error:function(r,i,s){console.error("Retrieving a '"+e+"' records with query '"+t+"' is failed! Details are below.");console.debug(r);console.debug(i);console.debug(s);n(null)}})}else{console.warn("retrieveWithQuery function needs jQuery library to execute. Please include jQuery.")}};this.updateEntity=function(e,t,n,r,i){if(jQuery){var s=this.getServiceUrl();var o="/"+e+"Set(guid'"+t+"')";console.log("Updating '"+e+"' entity with id '"+t+"'. Changes are in below.");console.log(n);if(!top.window.JSON){console.warn("window.JSON not found, please include json2.js!")}var u=top.window.JSON.stringify(n);$.ajax({async:i!=undefined?i:this.async,type:"POST",contentType:"application/json; charset=utf-8",datatype:"json",data:u,url:s+o,beforeSend:function(e){e.setRequestHeader("Accept","application/json");e.setRequestHeader("X-HTTP-Method","MERGE")},success:function(n,i,s){console.info("'"+e+"' entity with id '"+t+"' is updated successfully!");r(true)},error:function(n,i,s){console.error("Updating '"+e+"' entity with id '"+t+"' is failed! Details are in below.");console.debug(n);console.debug(i);console.debug(s);r(false)}})}else{console.warn("updateEntity function needs jQuery library to execute. Please include jQuery.")}};this.createRecord=function(e,t,n,r){if(jQuery){var i=$$.getServiceUrl();var s="/"+e+"Set";console.log("Creating '"+e+"' entity. Values are in below.");console.log(t);if(!top.window.JSON){console.warn("window.JSON not found, please include json2.js!")}var o=top.window.JSON.stringify(t);$.ajax({async:r!=undefined?r:this.async,type:"POST",contentType:"application/json; charset=utf-8",datatype:"json",data:o,url:i+s,beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(t,r,i){console.info("'"+e+"' entity created successfully!");n(t["d"])},error:function(t,r,i){console.error("Creating '"+e+"' entity is failed! Details are in below.");console.debug(t);console.debug(r);console.debug(i);n(false)}})}else{console.warn("createRecord function needs jQuery library to execute. Please include jQuery.")}};this.deleteRecord=function(e,t,n,r){if(jQuery){var i=this.getServiceUrl();var s="/"+e+"Set(guid'"+t+"')";console.log("Deleting '"+e+"' entity with id '"+t+"'.");$.ajax({async:r!=undefined?r:this.async,type:"POST",contentType:"application/json; charset=utf-8",datatype:"json",url:i+s,beforeSend:function(e){e.setRequestHeader("Accept","application/json");e.setRequestHeader("X-HTTP-Method","DELETE")},success:function(r,i,s){console.info("'"+e+"' entity with id '"+t+"' deleted successfully!");n(true)},error:function(r,i,s){console.error("Deleting '"+e+"' entity with id '"+t+"' is failed! Details are in below.");console.debug(r);console.debug(i);console.debug(s);n(false)}})}else{console.warn("deleteRecord function needs jQuery library to execute. Please include jQuery.")}};this.sortTable=function(e,t,n){if(jQuery){e.find("td").filter(function(){return $(this).index()===t}).sortElements(function(e,t){return $.text([e])>$.text([t])?n?-1:1:n?1:-1},function(){return this.parentNode})}else{console.warn("sortTable function needs jQuery library to execute. Please include jQuery.")}};this.getFormattedDate=function(e,t){try{console.warn("Formatting date '"+e+"' with format '"+t+"'.");var n=new Date;n.setTime(e.getTime());var r=t.replace("yyyy",n.getFullYear()).replace("MM",(n.getMonth()<9?"0":"")+(n.getMonth()+1)).replace("dd",(n.getDate()<10?"0":"")+n.getDate()).replace("HH",(n.getHours()<10?"0":"")+n.getHours()).replace("mm",(n.getMinutes()<10?"0":"")+n.getMinutes()).replace("ss",(n.getSeconds()<10?"0":"")+n.getSeconds());return r}catch(i){console.warn("Formatting date '"+e+"' with format '"+t+"' failed!");console.debug(i);return null}};this.parseJSONDate=function(e){try{console.log("Parsing json date '"+e+"'");return new Date(parseInt(e.replace("/Date(","").replace(")/",""),10))}catch(t){console.warn("Parsing json date '"+e+"' is failed!");console.debug(t);return null}};this.queryString=function(e){try{console.log("Getting querystring value of '"+e+"'");var t=window.location.search.substring(1);var n=t.split("&");for(i=0;i<n.length;i++){var r=n[i].split("=");if(r[0]==e){return r[1]}}}catch(s){console.warn("Getting querystring value of '"+e+"' is failed!");console.debug(s);return null}};this.ifNull=function(e,t){try{console.log("Checking value of '"+e+"' and return '"+t+"' if its null.");t=t!=undefined?t:"---";return e==null||e==""?t:e}catch(n){console.warn("Checking value of '"+e+"' and return '"+t+"' if its null is failed!");console.debug(n);return null}};this.toUpperCase=function(e){try{console.log("Converting '"+e+"' to upper case.");e=e===null?"":e;return e.replace(/ı/g,"I").replace(/i/g,"İ").toUpperCase()}catch(t){console.warn("Converting '"+e+"' to upper case is failed!");console.debug(t);return null}};this.toLowerCase=function(e){try{console.log("Converting '"+e+"' to lower case.");e=e===null?"":e;return e.replace(/I/g,"ı").replace(/İ/g,"i").toLowerCase()}catch(t){console.warn("Converting '"+e+"' to lower case is failed!");console.debug(t);return null}};this.toProperCase=function(e){try{console.log("Converting '"+e+"' to proper case.");e=e===null?"":e;return e.replace(/\w\S*/g,function(e){return $$.toUpperCase(e.charAt(0))+$$.toLowerCase(e.substr(1))})}catch(t){console.warn("Converting '"+e+"' to proper case is failed!");console.debug(t);return null}};this.setUpperCase=function(e){try{console.log("Setting '"+e+"' value to upper case.");var t=this.getValue(e);this.setValue(e,this.toUpperCase(t))}catch(n){console.warn("Setting '"+e+"' value to upper case is failed!");console.debug(n)}};this.setLowerCase=function(e){try{console.log("Setting '"+e+"' value to lower case.");var t=this.getValue(e);this.setValue(e,this.toLowerCase(t))}catch(n){console.warn("Setting '"+e+"' value to lower case is failed!");console.debug(n)}};this.setProperCase=function(e){try{console.log("Setting '"+e+"' value to proper case.");var t=this.getValue(e);this.setValue(e,this.toProperCase(t))}catch(n){console.warn("Setting '"+e+"' value to proper case is failed!");console.debug(n)}};this.areGuidsEqual=function(e,t){try{console.log("Checking '"+e+"' and '"+t+"' is equal guids.");e=e.toString().replace(/[{}]/g,"").toLowerCase();t=t.toString().replace(/[{}]/g,"").toLowerCase();return e===t}catch(n){console.warn("Checking '"+e+"' and '"+t+"' is equal guids is failed!");console.debug(n);return false}};this.openEntity=function(e,t){try{console.log("Opening '"+e+"' with id '"+t+"'.");t=t!=undefined?t.replace("{","").replace("}",""):null;var n=this.getServerUrl()+"/main.aspx?etn="+e+(t!=null?"&id="+t:"")+"&pagetype=entityrecord";var r=1020;var i=screen.height-50;var s=(screen.width-r)/2;var o=e+t.replace(/-/gi,"");window.open(n,o,"width=1020,height="+i+",top=0,left="+s+", scrollbars=0,resizable=1")}catch(u){console.warn("Opening '"+e+"' with id '"+t+"' is failed.");console.debug(u)}};this.getOptionSetLabel=function(e,t,n,r,i){try{console.log("Getting '"+i+"' option set label for '"+e+"' entity, '"+t+"' attribute.");var s='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">';s+="<s:Body>";s+='<Execute xmlns="http://schemas.microsoft.com/xrm/2011/Contracts/Services" xmlns:i="http://www.w3.org/2001/XMLSchema-instance">';s+='<request i:type="a:RetrieveAttributeRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">';s+='<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">';s+="<a:KeyValuePairOfstringanyType>";s+="<b:key>EntityLogicalName</b:key>";s+='<b:value i:type="c:string" xmlns:c="http://www.w3.org/2001/XMLSchema">'+e+"</b:value>";s+="</a:KeyValuePairOfstringanyType>";if(n==null){n="00000000-0000-0000-0000-000000000000"}s+="<a:KeyValuePairOfstringanyType>";s+="<b:key>MetadataId</b:key>";s+='<b:value i:type="ser:guid"  xmlns:ser="http://schemas.microsoft.com/2003/10/Serialization/">'+n+"</b:value>";s+="</a:KeyValuePairOfstringanyType>";s+="<a:KeyValuePairOfstringanyType>";s+="<b:key>RetrieveAsIfPublished</b:key>";s+='<b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">'+r+"</b:value>";s+="</a:KeyValuePairOfstringanyType>";s+="<a:KeyValuePairOfstringanyType>";s+="<b:key>LogicalName</b:key>";s+='<b:value i:type="c:string"   xmlns:c="http://www.w3.org/2001/XMLSchema">'+t+"</b:value>";s+="</a:KeyValuePairOfstringanyType>";s+="</a:Parameters>";s+='<a:RequestId i:nil="true" /><a:RequestName>RetrieveAttribute</a:RequestName></request>';s+="</Execute>";s+="</s:Body>";s+="</s:Envelope>";var o=new XMLHttpRequest;o.open("POST",this.getSoapUrl(),false);o.setRequestHeader("Accept","application/xml, text/xml, */*");o.setRequestHeader("Content-Type","text/xml; charset=utf-8");o.setRequestHeader("SOAPAction","http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/Execute");o.send(s);var u={a:"http://schemas.microsoft.com/xrm/2011/Contracts",b:"http://schemas.datacontract.org/2004/07/System.Collections.Generic",c:"http://schemas.microsoft.com/xrm/2011/Metadata"};if(o.responseXML!=null){var a=$$.selectSingleNode(o.responseXML,"//b:value",u);if(a!=null){var f=$$.selectSingleNode(a,"c:AttributeType",u);var l=f.text||f.textContent;switch(l){case"Picklist":return $$.getPickListTextValue(a,i,u);default:break}}}}catch(c){console.warn("Getting '"+i+"' option set label for '"+e+"' entity, '"+t+"' attribute is failed!");console.debug(c);return null}};this.getOptionSet=function(e,t,n,r){try{console.log("Getting option set labels for '"+e+"' entity, '"+t+"' attribute.");var i='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">';i+="<s:Body>";i+='<Execute xmlns="http://schemas.microsoft.com/xrm/2011/Contracts/Services" xmlns:i="http://www.w3.org/2001/XMLSchema-instance">';i+='<request i:type="a:RetrieveAttributeRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">';i+='<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">';i+="<a:KeyValuePairOfstringanyType>";i+="<b:key>EntityLogicalName</b:key>";i+='<b:value i:type="c:string" xmlns:c="http://www.w3.org/2001/XMLSchema">'+e+"</b:value>";i+="</a:KeyValuePairOfstringanyType>";if(n==null){n="00000000-0000-0000-0000-000000000000"}i+="<a:KeyValuePairOfstringanyType>";i+="<b:key>MetadataId</b:key>";i+='<b:value i:type="ser:guid"  xmlns:ser="http://schemas.microsoft.com/2003/10/Serialization/">'+n+"</b:value>";i+="</a:KeyValuePairOfstringanyType>";i+="<a:KeyValuePairOfstringanyType>";i+="<b:key>RetrieveAsIfPublished</b:key>";i+='<b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">'+r+"</b:value>";i+="</a:KeyValuePairOfstringanyType>";i+="<a:KeyValuePairOfstringanyType>";i+="<b:key>LogicalName</b:key>";i+='<b:value i:type="c:string"   xmlns:c="http://www.w3.org/2001/XMLSchema">'+t+"</b:value>";i+="</a:KeyValuePairOfstringanyType>";i+="</a:Parameters>";i+='<a:RequestId i:nil="true" /><a:RequestName>RetrieveAttribute</a:RequestName></request>';i+="</Execute>";i+="</s:Body>";i+="</s:Envelope>";var s=new XMLHttpRequest;s.open("POST",this.getSoapUrl(),false);s.setRequestHeader("Accept","application/xml, text/xml, */*");s.setRequestHeader("Content-Type","text/xml; charset=utf-8");s.setRequestHeader("SOAPAction","http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/Execute");s.send(i);var o={a:"http://schemas.microsoft.com/xrm/2011/Contracts",b:"http://schemas.datacontract.org/2004/07/System.Collections.Generic",c:"http://schemas.microsoft.com/xrm/2011/Metadata"};if(s.responseXML!=null){var u=$$.selectSingleNode(s.responseXML,"//b:value",o);if(u!=null){var a=new Array;var f=$$.selectSingleNode(u,"c:OptionSet//c:Options",o);for(var l=0;l<f.childNodes.length;l++){var c={};var h=$$.selectSingleNode(f.childNodes[l],"c:Value",o);var p=h.text||h.textContent;var d=$$.selectSingleNode(f.childNodes[l],"c:Label",o);var v=$$.selectSingleNode(d,"a:UserLocalizedLabel",o);var m=$$.selectSingleNode(v,"a:Label",o);var g=m.text||m.textContent;c.value=p;c.text=g;a.push(c)}return a}}}catch(y){console.warn("Getting option set labels for '"+e+"' entity, '"+t+"' attribute is failed!");console.debug(y);return null}};this.getPickListTextValue=function(e,t,n){var r=$$.selectSingleNode(e,"c:OptionSet//c:Options",n);for(var i=0;i<r.childNodes.length;i++){var s=$$.selectSingleNode(r.childNodes[i],"c:Value",n);var o=s.text||s.textContent;if(o==t){var u=$$.selectSingleNode(r.childNodes[i],"c:Label",n);var a=$$.selectSingleNode(u,"a:UserLocalizedLabel",n);var f=$$.selectSingleNode(a,"a:Label",n);var l=f.text||f.textContent;return l}}};this.setState=function(e,t,n,r,i,s){try{console.log("Setting state '"+e+"' entity state to '"+n+"', status to '"+r+"'.");i=i==undefined?null:i;s=s==undefined?null:s;var o="";o+='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">';o+="  <s:Body>";o+='    <Execute xmlns="http://schemas.microsoft.com/xrm/2011/Contracts/Services" xmlns:i="http://www.w3.org/2001/XMLSchema-instance">';o+='      <request i:type="b:SetStateRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts" xmlns:b="http://schemas.microsoft.com/crm/2011/Contracts">';o+='        <a:Parameters xmlns:c="http://schemas.datacontract.org/2004/07/System.Collections.Generic">';o+="          <a:KeyValuePairOfstringanyType>";o+="            <c:key>EntityMoniker</c:key>";o+='            <c:value i:type="a:EntityReference">';o+="              <a:Id>"+t+"</a:Id>";o+="              <a:LogicalName>"+e+"</a:LogicalName>";o+='              <a:Name i:nil="true" />';o+="            </c:value>";o+="          </a:KeyValuePairOfstringanyType>";o+="          <a:KeyValuePairOfstringanyType>";o+="            <c:key>State</c:key>";o+='            <c:value i:type="a:OptionSetValue">';o+="              <a:Value>"+n+"</a:Value>";o+="            </c:value>";o+="          </a:KeyValuePairOfstringanyType>";o+="          <a:KeyValuePairOfstringanyType>";o+="            <c:key>Status</c:key>";o+='            <c:value i:type="a:OptionSetValue">';o+="              <a:Value>"+r+"</a:Value>";o+="            </c:value>";o+="          </a:KeyValuePairOfstringanyType>";o+="        </a:Parameters>";o+='        <a:RequestId i:nil="true" />';o+="        <a:RequestName>SetState</a:RequestName>";o+="      </request>";o+="    </Execute>";o+="  </s:Body>";o+="</s:Envelope>";var u=new XMLHttpRequest;u.open("POST",this.getSoapUrl(),true);u.setRequestHeader("Accept","application/xml, text/xml, */*");u.setRequestHeader("Content-Type","text/xml; charset=utf-8");u.setRequestHeader("SOAPAction","http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/Execute");u.onreadystatechange=function(){$$.setStateResponse(u,i,s)};u.send(o)}catch(a){console.warn("Setting state '"+e+"' entity state to '"+n+"', status to '"+r+"' is failed!");console.debug(a);return false}};this.setStateResponse=function(e,t,n){if(e.readyState==4){if(e.status==200){if(t!=null){t()}}else{n(this._getError(e.responseXML))}}};this.retrieveAllEntities=function(e,t,n,r,i){n=n!=undefined?n:true;r=r!=undefined?r:true;i=i!=undefined?i:this.async;var s="";s+='<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">';s+="  <s:Body>";s+='    <Execute xmlns="http://schemas.microsoft.com/xrm/2011/Contracts/Services" xmlns:i="http://www.w3.org/2001/XMLSchema-instance">';s+='      <request i:type="a:RetrieveAllEntitiesRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">';s+='        <a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">';s+="          <a:KeyValuePairOfstringanyType>";s+="            <b:key>EntityFilters</b:key>";s+='            <b:value i:type="c:EntityFilters" xmlns:c="http://schemas.microsoft.com/xrm/2011/Metadata">Privileges</b:value>';s+="          </a:KeyValuePairOfstringanyType>";s+="          <a:KeyValuePairOfstringanyType>";s+="            <b:key>RetrieveAsIfPublished</b:key>";s+='            <b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">'+(n?"true":"false")+"</b:value>";s+="          </a:KeyValuePairOfstringanyType>";s+="        </a:Parameters>";s+='        <a:RequestId i:nil="true" />';s+="        <a:RequestName>RetrieveAllEntities</a:RequestName>";s+="      </request>";s+="    </Execute>";s+="  </s:Body>";s+="</s:Envelope>";var o=new XMLHttpRequest;o.open("POST",this.getSoapUrl(),i);o.setRequestHeader("Accept","application/xml, text/xml, */*");o.setRequestHeader("Content-Type","text/xml; charset=utf-8");o.setRequestHeader("SOAPAction","http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/Execute");o.onreadystatechange=function(){if(o.readyState==4){if(o.status==200){var n={a:"http://schemas.microsoft.com/xrm/2011/Contracts",b:"http://schemas.datacontract.org/2004/07/System.Collections.Generic",c:"http://schemas.microsoft.com/xrm/2011/Metadata"};var i=[];if(o.responseXML!=null){var s=$$.selectSingleNode(o.responseXML,"//b:value",n);if(s!=null){for(var u=0;u<s.childNodes.length;u++){var a=$$.selectSingleNode(s.childNodes[u],"c:IsCustomEntity",n);var f=(a.text||a.textContent)==="true";if(r&&f||!r){var l=$$.selectSingleNode(s.childNodes[u],"c:ObjectTypeCode",n);var c=$$.selectSingleNode(s.childNodes[u],"c:LogicalName",n);var h=$$.selectSingleNode(s.childNodes[u],"c:DisplayName",n);var p=$$.selectSingleNode(h,"a:UserLocalizedLabel",n);var d=$$.selectSingleNode(p,"a:Label",n);var v=d!=null?d.text||d.textContent:c;i.push({objectTypeCode:l.text||l.textContent,logicalName:c.text||c.textContent,displayName:v})}}}}if(typeof e=="function")e(i)}else{if(typeof t=="function")t(this._getError(o.responseXML))}}};o.send(s)};this._getError=function(e){var t="Unknown Error (Unable to parse the fault)";if(typeof e=="object"){try{var n=e.firstChild.firstChild;for(var r=0;r<n.childNodes.length;r++){var i=n.childNodes[r];if("s:Fault"==i.nodeName){for(var s=0;s<i.childNodes.length;s++){var o=i.childNodes[s];if("faultstring"==o.nodeName){t=o.text;break}}break}}}catch(u){}}return new Error(t)};this.selectSingleNode=function(e,t,n){var r=e.nodeType!=9?e.ownerDocument:e;if(typeof r.evaluate!="undefined"){var i=null;if(n instanceof Object){i=function(e){return n[e]}}var s=r.evaluate(t,e,i,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return s!==null?s.singleNodeValue:null}else if(typeof e.selectSingleNode!="undefined"){if(n instanceof Object){var o="";for(var u in n){if(n.hasOwnProperty(u)){o+="xmlns:"+u+"='"+n[u]+"' "}}r.setProperty("SelectionNamespaces",o)}return e.selectSingleNode(t)}else{console.warn("No xpath engine found")}}}window.$$=new arunesCrmJsLib